var weekdayNumber=(new Date).getDay()-1;var jsonDone=0;var errorString="Keine Daten abrufbar.";$(document).ready(function(){$("#welcomePage").live("pagebeforeshow",function(){$("#downloadSliderBox").find('input[type="number"]').hide()});$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'http%3A%2F%2Fwww.studentenwerk-pb.de%2Ffileadmin%2Fxml%2Fmensa.xml'%20&format=json&callback=?",function(a){try{setPlan(a,$("#weekMensa"));updateSlider()}catch(b){log("error",b);$("#weekPalmengarten").append("<center><h3>"+errorString+"</h3></center>");updateSlider()}});$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'http%3A%2F%2Fwww.studentenwerk-pb.de%2Ffileadmin%2Fxml%2Fpalmengarten.xml'%20&format=json&callback=?",function(a){try{setPlan(a,$("#weekPalmengarten"));updateSlider()}catch(b){log("error",b);$("#weekPalmengarten").append("<center><h3>"+errorString+"</h3></center>");updateSlider()}});$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'http%3A%2F%2Fwww.studentenwerk-pb.de%2Ffileadmin%2Fxml%2Fgownsmenspub.xml'%20&format=json&callback=?",function(a){try{setPlan(a,$("#weekGownsmenspub"));updateSlider()}catch(b){log("error",b);$("#weekGownsmenspub").append("<center><h3>"+errorString+"</h3></center>");updateSlider()}});$.getJSON("http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D'http%3A%2F%2Fwww.studentenwerk-pb.de%2Ffileadmin%2Fxml%2Fmensula.xml'%20&format=json&callback=?",function(c){try{c=c.query.results.plan;var a="<center><h3>"+c.tag[0].wochentag+" ("+c.tag[0].datum+')</h3></center><ul data-role="listview" data-inset="true">';a+='<li data-role="list-divider" >'+c.tag[0].menue.menu+"</li>";a+=createMensulaEntry(c.tag[0].menue);a+='<li data-role="list-divider" >'+c.tag[1].menue[0].menu+"</li>";for(var b=0;b<c.tag[1].menue.length;b++){a+=createMensulaEntry(c.tag[1].menue[b])}a+='<li data-role="list-divider" >'+c.tag[2].menue.menu+"</li>";a+=createMensulaEntry(c.tag[2].menue);a+="</ul>";$("#weekMensula").append(a);updateSlider()}catch(d){log("error",d);$("#weekMensula").append("<center><h3>"+errorString+"</h3></center>");updateSlider()}})});function setPlan(e,d){e=e.query.results.plan;for(var c=0;c<e.tag.length;c++){var a='<ul data-role="listview" data-inset="true">';if(e.tag[c].menue.length==null){a+=createListEntry(e.tag[c].menue)}else{for(var b=0;b<e.tag[c].menue.length;b++){a+=createListEntry(e.tag[c].menue[b])}}a+="</ul>";var f='<div data-role="collapsible"';if(c!=weekdayNumber){f+='data-collapsed="true"'}f+="><h3>"+e.tag[c].wochentag+" ("+e.tag[c].datum+")</h3>"+a+"</div>";d.append(f)}if(typeof e.tag.length=="undefined"){d.append("<center><h3>"+errorString+"</h3></center>")}}function createListEntry(c){var a="<li><p>"+c.menu;if(c.preis!=null){a+=" ("+c.preis+")"}a+="</p><h6>"+c.text+"</h6>";if(c.beilage!=null){a+="<p>";for(var b=0;b<c.beilage.length;b++){a+=c.beilage[b]+" "}a+="</p>"}if(c.ausgabe!=null){a+="<p><strong>Ausgabe:</strong> "+c.ausgabe+"</p>"}if(c.speisentyp!=null){a+="<p> ("+c.speisentyp+")</p>"}a+="</li>";return a}function createMensulaEntry(b){var a="<li><h3>"+b.text;if(b.preis!=null){a+=" ("+b.preis+")"}a+="</h3>";if(b.beilage!=null){a+="<p><strong>Beilage:</strong> "+b.beilage.toString()+"</p>"}if(b.ausgabe!=null){a+="<p><strong>Ausgabe:</strong> "+b.ausgabe+"</p>"}if(b.speisentyp!=null){a+="<p> ("+b.speisentyp+")</p>"}a+="</li>";return a}function updateSlider(){jsonDone++;$("#downloadSlider").val(jsonDone).slider("refresh");if(jsonDone==4){$("#downloadSliderBox").fadeOut(800);$.mobile.changePage("#mensa")}};